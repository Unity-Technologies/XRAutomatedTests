#split this out into trunk_RunAllYamatoTests and trunk_RunAllJenlinsTests

trunk_RunAllTests:
  name: trunk_RunAllTests
  agent:
    type: Unity::VM
    image: cds-ops/ubuntu-18.04-base:stable
    flavor: b1.small
  variables:
    unityVERSION: trunk
  dependencies:
    - path: .yamato/trunk-FunctionalTests.yml#trunk_FunctionalTests
      rerun: always
  commands:
    - |
      #switch to our scripts folder.
      cd .yamato

      #Install the python library requests, so that we can make web requests.
      pip install requests

      python -c '
      import utility.JenkinsJob
      import os
      import sys

      project_name = "Trunk-Run_All_Tests_new"

      #Retrieve the UnityVERSION, and then determine what type of version it is. (IE: BranchName, UnityVersion, or UnityRevision)
      version = os.getenv("unityVERSION")
      versionType = utility.JenkinsJob.parse_version(version)
      #Set the versionType and Version for passing to the Jenkins job.
      params = { versionType : version }

      #Invoke the Jenkins Job, and wait for it to complete before returning.
      result = utility.JenkinsJob.start_job(project_name,params,True,True)
      print("result:" + result)

      #check to see if we were successful, otherwise exit out with an error.
      if result != "SUCCESS":
        sys.exit("Jenkins Job: " + project_name +" has failed!") '
  artifacts:
    logs:
      paths:
        - ".yamato/build/test-results/**"