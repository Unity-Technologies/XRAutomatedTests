#rename to trigger jobs.

trunk-NightlyTrigger:
  name: trunk-NightlyTrigger
  agent:
      type: Unity::VM
      image: cds-ops/ubuntu-18.04-base:stable
      flavor: b1.small
  triggers:
    recurring:
      - branch: trunk
        frequency: 8 * * ?
  commands:
    - |
      #switch to our scripts folder.
      cd .yamato

      #Manually install required python packages.
      pip install unity-downloader-cli --extra-index-url https://artifactory.internal.unity3d.com/api/pypi/common-python/simple --user
      pip install requests

      python -c '
      import os
      import utility.versionCheck
      import utility.YamatoJobs

      unity_version = utility.versionCheck.check_for_new_version("trunk")
      print("New unity version:" + unity_version)
      if unity_version != "no_new_version":
        project_id = utility.YamatoJobs.get_project_id("xr.xrautomatedtests")
        utility.YamatoJobs.start_job(project_id,"trunk-RunAllTests.yml","trunk","trunk_RunAllTests")'